## JustLogin Angular Scaffold

This is a scaffolding project to be used as the basis for Angular applications being developed for JustLogin. This application contains a common interface and authentication components required to integrate with JustLogin ecosystem.

### Prerequisities

Configure `npm` to be able to access JustLogin repository

```bash
npm config set @justlogin:registry https://www.myget.org/F/justlogin/auth/f5721c3e-d13c-4de8-9fd7-bb60dc16cfe8/npm/
```

> This states any package with the `@justlogin` scope will be loaded from the JustLogin repository

```bash
npm install
```

### Authentication

Your application routes should be protected by an Authentication Guard. You should use the in-build `canActivate` method `AuthGuard` from the express-ui component. If you need custom guards you can add these as necessary.

> Note that Angular router guards process async, therefore it's not guaranteed that data being generated by one guard will be available in the other. If you need to guarantee this, then create your routes as partent child and add your auth guards here as needed, the partent auth guard will always execute first.

To automatically log into your application you can pass an exchange token in the querystring to any route that is protected by the express-ui `AuthGuard`.

Example `/secure-world?token=06763b37d8944136b041763de1d08239`


### Feature Flags

The project comes with an inbuilt feature flagging service provided by [Floodgate](https://floodgate.io). `FloodgateService` is a service that is exposed by the `@justlogin/express-ui` component. You can use this service out of the box by injecting `FloodgateService` into your component as needed.

#### Check a Flag Value

The following code snippet shows how to use a feature flag within your code.

```javascript
    // Inject private floodgateService: FloodgateService into your component constructor

    const enableMixpanel = this.floodgateService.getValue("mixpanel", false);
    if (enableMixpanel == 'true') {
        this.mixpanelService.track("something to track...");
    }
```

### Hosting

This application will be hosted along side other JustLogin applications written in Angular. All these applications will be accessed via the same URL `https://app.justlogin.com/`, because of this you need to set the `base href` in the `index.html` file to the required application path name.

> In this example application the base url is `scaffold`.


### Environment Files

All configuration for the application should go into the environment files. Remember to add the necessary configuration to each of the environemnt files for dev, staging and production.

## Development & Building

### Run

```bash
npm start
ng serve --port 5200 // to run on different port
```

To run using alternative configurations, use
```
ng serve --configuration=staging|prod
```

### Build

To allow side by side Angular applications we need to set the base URL path in `index.html`

Add `<base href="/app_name">` to `index.html`
> Update `app_name` to the base path of the application URL, for example `/people`.

```bash
npm version <major | minor | patch>

ng build --base-href=/app_name/ --configuration=staging
```

### Code scaffolding

Run `ng generate component component-name` to generate a new component. You can also use `ng generate directive|pipe|service|class|guard|interface|enum|module`.

### Running unit tests

Run `ng test` to execute the unit tests via [Karma](https://karma-runner.github.io).

### Running end-to-end tests

Run `ng e2e` to execute the end-to-end tests via [Protractor](http://www.protractortest.org/).

#### Examples

```bash
ng build --base-href=/people/ --configuration=staging

ng build --base-href=/people/ --configuration=production
```

> app_name should be same as hosting folder, for example `/people`

### Deploy

When deploying to IIS make sure the web.config file is deployed to the website root folder.

This application comes with `buildspec` and `appspec` files to aid in automatic deployments to the IIS host server. A AWS CodePipeline can be created to take advantage of these files to perform auto-deployments.

## Further help

To get more help on the Angular CLI use `ng help` or go check out the [Angular CLI README](https://github.com/angular/angular-cli/blob/master/README.md).

## Creating new Module

```bash
ng generate module <your-module-name> --routing --dry-run
```
> Remove the `--dry-run` flag to make the necessary changes

## Creating new Component

```bash
ng generate component <your-component-name> --module=<your-module-name> --skip-tests --dry-run
```
> Remove the `--dry-run` flag to make the necessary changes

## Known Issues

### ng2-datetime Build Error

When you first run there maybe an error in an external component in the `node_modules/ng2-datetime` folder. If this happens, delete the file `ng2-datetime.spec.ts`
